# 🛠️ Chapter 2 – Building Infrastructure

When building infrastructure using code, it is considered best practice to store all configuration and resource definitions in a version control system such as Git.

However, certain files generated by Terraform during the planning and execution process should **not** be committed to the repository. These include files that may contain sensitive data or local environment-specific information.

When creating or configuring a Terraform repository, it is recommended to add the following entries to the `.gitignore` file:

- `.terraform/`
- `*.tfstate`
- `*.tfstate.backup`

These files may include secrets, access credentials, IP addresses, and other metadata that should remain private and environment-specific.

> 🔗 **Note:** To learn more about how `.gitignore` works, you can refer to  [this article](https://pscustomobject.github.io/git/version-control/getting-started-with-gitignore/) or the official Git documentation: [git-scm.com/docs/gitignore](https://git-scm.com/docs/gitignore)

---

## 🔄 Updating Infrastructure

By default, when a change is made to a resource (e.g., an EC2 instance), Terraform attempts to **update the resource in place** without destroying it. This behavior ensures minimal disruption to running infrastructure.

However, there are cases where this is not desirable — for example, when updating the `user_data` script of an EC2 instance. Since `user_data` is only executed **on first boot**, simply updating the instance will not apply the new script.

To force Terraform to destroy and recreate the resource when certain attributes change, the `user_data_replace_on_change = true` parameter can be used:

```hcl
resource "aws_instance" "example" {
  ami                         = "ami-0123456789abcdef0"
  instance_type               = "t2.micro"
  user_data                   = file("setup.sh")
  user_data_replace_on_change = true
}
```

This instructs Terraform to treat changes to *user_data* as non-updatable, and instead replace the instance to apply the changes correctly.

    💡 Use this setting with care, as it will cause resource replacement and potential downtime depending on the resource type.
